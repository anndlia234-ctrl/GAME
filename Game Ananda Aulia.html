<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Galaksi Bangun Ruang</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        .planet-icon {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .planet-icon:hover {
            transform: scale(1.15);
        }

        .planet-icon.locked {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(100%) brightness(0.6);
        }

        .planet-icon.completed {
            animation: glow 2s infinite;
        }

        .planet-icon.active {
            animation: planetPulse 2s ease-in-out infinite;
        }

        @keyframes planetPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes lockedShake {
            0%, 100% { transform: translateX(0) scale(1); }
            25% { transform: translateX(-5px) scale(1); }
            75% { transform: translateX(5px) scale(1); }
        }

        @keyframes unlockAnimation {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 0.5; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }

        @keyframes completionRing {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        .completion-ring {
            position: absolute;
            inset: -10px;
            border-radius: 50%;
            border: 3px solid;
            animation: completionRing 1.5s ease-out infinite;
        }

        .spaceship {
            position: absolute;
            font-size: 32px;
            transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
            z-index: 15;
        }

        @keyframes trailFade {
            0% { opacity: 0.8; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.5); }
        }

        .trail {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255, 255, 255, 1), transparent);
            border-radius: 50%;
            pointer-events: none;
            animation: trailFade 0.8s ease-out forwards;
        }

        .planet-icon-inner {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .material-icon {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            z-index: 5;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }

        .orbit-line {
            position: absolute;
            stroke-dasharray: 5, 5;
            stroke-width: 2;
            fill: none;
            opacity: 0.3;
            transition: all 0.5s ease;
        }

        .orbit-line.active {
            stroke-dasharray: 0;
            opacity: 0.8;
            animation: orbitGlow 2s ease-in-out infinite;
        }

        @keyframes orbitGlow {
            0%, 100% { filter: drop-shadow(0 0 5px currentColor); }
            50% { filter: drop-shadow(0 0 15px currentColor); }
        }

        .tooltip {
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 30;
        }

        .planet-icon:hover .tooltip {
            opacity: 1;
        }

        .planet-icon.locked:hover .tooltip {
            opacity: 1;
        }

        .answer-btn {
            transition: all 0.2s ease;
        }

        .answer-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .answer-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .heart {
            display: inline-block;
            font-size: 24px;
            animation: pulse 1s infinite;
        }

        .planet-sphere {
            border-radius: 50%;
            position: relative;
            box-shadow: inset -25px -25px 40px rgba(0,0,0,.5);
        }

        .planet-sphere::before {
            content: '';
            position: absolute;
            top: 10%;
            left: 10%;
            width: 40%;
            height: 40%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4), transparent);
            border-radius: 50%;
        }

        .planet-ring {
            position: absolute;
            width: 140%;
            height: 30%;
            border: 3px solid;
            border-radius: 50%;
            top: 35%;
            left: -20%;
            opacity: 0.6;
            transform: rotateX(75deg);
        }

        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            box-shadow: 0 0 10px white;
        }

        @keyframes shoot {
            0% {
                transform: translateX(0) translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-300px) translateY(300px);
                opacity: 0;
            }
        }

        @keyframes correctAnswer {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes nebula {
            0%, 100% { opacity: 0.3; transform: scale(1) rotate(0deg); }
            50% { opacity: 0.6; transform: scale(1.2) rotate(180deg); }
        }

        .nebula {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            filter: blur(60px);
            animation: nebula 20s infinite;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            pointer-events: none;
        }

        @keyframes buttonGlow {
            0% { box-shadow: 0 4px 30px rgba(99, 102, 241, 0.6), 0 0 20px rgba(99, 102, 241, 1); }
            50% { box-shadow: 0 8px 60px rgba(99, 102, 241, 1), 0 0 80px rgba(99, 102, 241, 1); }
            100% { opacity: 0; transform: scale(1.5); }
        }

        @keyframes rocketZoomIn {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.15; }
            50% { transform: translate(-50%, -50%) scale(3); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(10); opacity: 0; }
        }

        @keyframes warpLine {
            0% { 
                transform: translateZ(0) translateX(-50%);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% { 
                transform: translateZ(1000px) translateX(-50%);
                opacity: 0;
            }
        }

        @keyframes galaxyFadeIn {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes uiFadeIn {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .warp-line {
            position: absolute;
            width: 2px;
            height: 200px;
            background: linear-gradient(to bottom, transparent, white, transparent);
            left: 50%;
            top: 50%;
            animation: warpLine 1s linear infinite;
            pointer-events: none;
        }

        @keyframes dangerBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full relative overflow-hidden"></div>
  <script>
        const defaultConfig = {
            background_color: "#0a0e27",
            primary_color: "#ffd700",
            secondary_color: "#00d4ff",
            text_color: "#ffffff",
            button_color: "#6366f1",
            font_family: "Arial",
            font_size: 16,
            game_title: "Galaksi Bangun Ruang",
            start_button_text: "Mulai Misi",
            guide_button_text: "Panduan",
            victory_message: "You Are the Geometry Hero",
            crisis_title: "GALAKSI BANGUN RUANG DALAM BAHAYA!",
            mission_button: "TERIMA MISI!"
        };

        let config = { ...defaultConfig };

        const planets = [
            {
                name: "KUBUS",
                color: "#ff8c00",
                icon: "üßä",
                class: "Kelas 5-6",
                topic: "Bangun Ruang Kubus",
                story: {
                    intro: "üßä PLANET KUBUS\n\nPlanet berbentuk kubus ini kehilangan strukturnya! Semua rusuk, sisi, dan titik sudutnya kacau. Bantu perbaiki dengan menjawab soal tentang kubus!",
                    progress: "Struktur diperbaiki",
                    success: "üéâ KUBUS SEMPURNA! Semua rusuk, sisi, dan titik sudut kubus kembali normal! Planet kubus terselamatkan!",
                    visual: "rocket"
                },
                questions: [
                    { q: "Berapa jumlah rusuk pada kubus?", answers: ["12", "8", "6", "10"], correct: 0 },
                    { q: "Berapa jumlah sisi pada kubus?", answers: ["6", "8", "12", "4"], correct: 0 },
                    { q: "Berapa jumlah titik sudut pada kubus?", answers: ["8", "6", "12", "10"], correct: 0 },
                    { q: "Semua sisi kubus berbentuk?", answers: ["Persegi", "Segitiga", "Persegi panjang", "Lingkaran"], correct: 0 },
                    { q: "Jika panjang rusuk kubus 5 cm, berapa jumlah panjang 4 rusuknya?", answers: ["20 cm", "15 cm", "25 cm", "30 cm"], correct: 0 }
                ]
            },
            {
                name: "BALOK",
                color: "#00a8ff",
                icon: "üì¶",
                class: "Kelas 5-6",
                topic: "Bangun Ruang Balok",
                story: {
                    intro: "üì¶ PLANET BALOK\n\nKotak-kotak di planet balok tidak seimbang! Panjang, lebar, dan tingginya tidak terukur dengan benar. Selesaikan soal balok untuk memperbaikinya!",
                    progress: "Balok terukur",
                    success: "‚ú® BALOK SEIMBANG! Semua ukuran balok kembali proporsional! Planet balok aman!",
                    visual: "crystal"
                },
                questions: [
                    { q: "Berapa jumlah rusuk pada balok?", answers: ["12", "8", "6", "10"], correct: 0 },
                    { q: "Berapa jumlah sisi pada balok?", answers: ["6", "8", "12", "4"], correct: 0 },
                    { q: "Berapa jumlah titik sudut pada balok?", answers: ["8", "6", "12", "10"], correct: 0 },
                    { q: "Balok memiliki ... pasang sisi yang sama?", answers: ["3", "2", "4", "6"], correct: 0 },
                    { q: "Sisi-sisi balok berbentuk?", answers: ["Persegi panjang", "Segitiga", "Lingkaran", "Trapesium"], correct: 0 }
                ]
            },
            {
                name: "KERUCUT",
                color: "#00e676",
                icon: "üç¶",
                class: "Kelas 5-6",
                topic: "Bangun Ruang Kerucut",
                story: {
                    intro: "üç¶ PLANET KERUCUT\n\nPlanet kerucut kehilangan puncaknya! Alas lingkaran dan selimutnya terpisah. Jawab soal kerucut untuk menyatukan kembali bagian-bagiannya!",
                    progress: "Bagian tersatukan",
                    success: "‚ö° KERUCUT UTUH! Puncak, selimut, dan alas kerucut menyatu sempurna! Planet terselamatkan!",
                    visual: "balance"
                },
                questions: [
                    { q: "Alas kerucut berbentuk?", answers: ["Lingkaran", "Segitiga", "Persegi", "Oval"], correct: 0 },
                    { q: "Berapa jumlah titik sudut pada kerucut?", answers: ["1", "2", "0", "3"], correct: 0 },
                    { q: "Berapa jumlah sisi pada kerucut?", answers: ["2", "1", "3", "4"], correct: 0 },
                    { q: "Bagian kerucut yang menghubungkan puncak ke tepi alas disebut?", answers: ["Garis pelukis", "Tinggi", "Diameter", "Jari-jari"], correct: 0 },
                    { q: "Kerucut memiliki ... rusuk?", answers: ["1", "2", "0", "3"], correct: 0 }
                ]
            },
            {
                name: "TABUNG",
                color: "#9c27b0",
                icon: "ü•´",
                class: "Kelas 5-6",
                topic: "Bangun Ruang Tabung",
                story: {
                    intro: "ü•´ PLANET TABUNG\n\nKaleng-kaleng raksasa di planet tabung kehilangan tutupnya! Kedua lingkaran alasnya terlepas dari selimut. Perbaiki dengan menjawab soal tabung!",
                    progress: "Tutup terpasang",
                    success: "üèôÔ∏è TABUNG TERTUTUP! Alas atas dan bawah kembali melekat sempurna! Planet tabung normal kembali!",
                    visual: "building"
                },
                questions: [
                    { q: "Berapa jumlah sisi pada tabung?", answers: ["3", "2", "4", "1"], correct: 0 },
                    { q: "Alas dan tutup tabung berbentuk?", answers: ["Lingkaran", "Persegi", "Segitiga", "Oval"], correct: 0 },
                    { q: "Berapa jumlah rusuk pada tabung?", answers: ["2", "0", "3", "4"], correct: 0 },
                    { q: "Berapa jumlah titik sudut pada tabung?", answers: ["0", "2", "4", "8"], correct: 0 },
                    { q: "Selimut tabung berbentuk?", answers: ["Persegi panjang (jika dibuka)", "Segitiga", "Lingkaran", "Trapesium"], correct: 0 }
                ]
            },
            {
                name: "PRISMA",
                color: "#f44336",
                icon: "üî∫",
                class: "Kelas 5-6",
                topic: "Bangun Ruang Prisma",
                story: {
                    intro: "üî∫ PLANET PRISMA\n\nPrisma segitiga di planet ini kehilangan bentuk alasnya! Segitiga alas dan tutupnya tidak sejajar lagi. Selamatkan dengan menjawab soal prisma!",
                    progress: "Prisma sejajar",
                    success: "üóùÔ∏è PRISMA TEGAK! Alas dan tutup prisma kembali sejajar sempurna! Planet prisma selamat!",
                    visual: "door"
                },
                questions: [
                    { q: "Prisma segitiga memiliki berapa sisi?", answers: ["5", "6", "4", "3"], correct: 0 },
                    { q: "Prisma segitiga memiliki berapa rusuk?", answers: ["9", "6", "12", "8"], correct: 0 },
                    { q: "Prisma segitiga memiliki berapa titik sudut?", answers: ["6", "8", "4", "5"], correct: 0 },
                    { q: "Alas dan tutup prisma segitiga berbentuk?", answers: ["Segitiga", "Persegi", "Lingkaran", "Segi lima"], correct: 0 },
                    { q: "Sisi tegak prisma segitiga berbentuk?", answers: ["Persegi panjang", "Segitiga", "Trapesium", "Lingkaran"], correct: 0 }
                ]
            },
            {
                name: "LIMAS",
                color: "#ffeb3b",
                icon: "üîª",
                class: "Kelas 5-6",
                topic: "Bangun Ruang Limas",
                story: {
                    intro: "üîª PLANET LIMAS\n\nPiramida raksasa di planet limas kehilangan puncaknya! Titik puncak terpisah dari alas segi empat. Kembalikan dengan menjawab soal limas!",
                    progress: "Puncak kembali",
                    success: "üì∂ LIMAS RUNCING! Titik puncak dan alas limas menyatu kembali! Planet piramida aman!",
                    visual: "antenna"
                },
                questions: [
                    { q: "Limas segi empat memiliki berapa sisi?", answers: ["5", "6", "4", "8"], correct: 0 },
                    { q: "Limas segi empat memiliki berapa rusuk?", answers: ["8", "12", "6", "10"], correct: 0 },
                    { q: "Limas segi empat memiliki berapa titik sudut?", answers: ["5", "4", "6", "8"], correct: 0 },
                    { q: "Alas limas segi empat berbentuk?", answers: ["Persegi atau persegi panjang", "Segitiga", "Lingkaran", "Segi lima"], correct: 0 },
                    { q: "Sisi tegak limas berbentuk?", answers: ["Segitiga", "Persegi", "Persegi panjang", "Trapesium"], correct: 0 }
                ]
            },
            {
                name: "BOLA",
                color: "#ffd700",
                icon: "‚öΩ",
                class: "Kelas 5-6",
                topic: "Bangun Ruang Bola",
                story: {
                    intro: "‚öΩ PLANET BOLA\n\nPlanet bulat sempurna ini kehilangan bentuk bulatnya! Jari-jari dan diameternya tidak konsisten. Selesaikan soal bola untuk mengembalikan kesempurnaannya!",
                    progress: "Bulat kembali",
                    success: "üíª BOLA SEMPURNA! Planet bola kembali bulat sempurna! Galaksi Bangun Ruang terselamatkan! MISI SELESAI!",
                    visual: "computer"
                },
                questions: [
                    { q: "Berapa jumlah sisi pada bola?", answers: ["1", "2", "0", "3"], correct: 0 },
                    { q: "Berapa jumlah rusuk pada bola?", answers: ["0", "1", "2", "4"], correct: 0 },
                    { q: "Berapa jumlah titik sudut pada bola?", answers: ["0", "1", "2", "4"], correct: 0 },
                    { q: "Jarak dari pusat bola ke permukaan disebut?", answers: ["Jari-jari", "Diameter", "Tinggi", "Rusuk"], correct: 0 },
                    { q: "Jika jari-jari bola 5 cm, berapa diameternya?", answers: ["10 cm", "15 cm", "5 cm", "20 cm"], correct: 0 }
                ]
            }
        ];

        let gameState = {
            screen: 'menu',
            lives: 3,
            currentPlanet: 0,
            currentQuestion: 0,
            completedPlanets: [],
            godMode: false,
            timeRemaining: 600,
            timerInterval: null
        };

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let backgroundMusicNodes = [];
        let isMusicPlaying = false;
        let soundEffectsEnabled = true;
        
        const notes = {
            C4: 261.63, D4: 293.66, E4: 329.63, F4: 349.23,
            G4: 392.00, A4: 440.00, B4: 493.88, C5: 523.25,
            E3: 164.81, G3: 196.00, C3: 130.81, F3: 174.61
        };

        const chordProgression = [
            [notes.C3, notes.E3, notes.G3, notes.C4],
            [notes.A4, notes.C4, notes.E4],
            [notes.F3, notes.A4, notes.C4],
            [notes.G3, notes.B4, notes.D4]
        ];

        const melodyPattern = [
            notes.E4, notes.G4, notes.C5, notes.G4, 
            notes.A4, notes.E4, notes.C4, notes.E4,
            notes.F4, notes.A4, notes.C5, notes.A4,
            notes.G4, notes.D4, notes.B4, notes.G4
        ];

        function playBackgroundMusic() {
            if (isMusicPlaying) return;
            isMusicPlaying = true;

            let chordIndex = 0;
            let melodyIndex = 0;
            const beatsPerMinute = 65;
            const beatDuration = 60 / beatsPerMinute;

            function playChord(frequencies, startTime, duration) {
                frequencies.forEach(freq => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    const filter = audioContext.createBiquadFilter();
                    
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(freq, startTime);
                    
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(2000, startTime);
                    filter.Q.setValueAtTime(1, startTime);
                    
                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(0.03, startTime + 0.1);
                    gain.gain.setValueAtTime(0.03, startTime + duration - 0.5);
                    gain.gain.linearRampToValueAtTime(0, startTime + duration);
                    
                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.start(startTime);
                    osc.stop(startTime + duration);
                    
                    backgroundMusicNodes.push({ osc, gain, filter });
                });
            }

            function playMelodyNote(freq, startTime, duration) {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                const filter = audioContext.createBiquadFilter();
                
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, startTime);
                
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(3000, startTime);
                
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.04, startTime + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.start(startTime);
                osc.stop(startTime + duration);
                
                backgroundMusicNodes.push({ osc, gain, filter });
            }

            function scheduleNextSection() {
                const currentTime = audioContext.currentTime;
                const chordDuration = beatDuration * 4;

                playChord(chordProgression[chordIndex], currentTime, chordDuration);

                for (let i = 0; i < 4; i++) {
                    const noteTime = currentTime + (i * beatDuration);
                    playMelodyNote(melodyPattern[melodyIndex], noteTime, beatDuration * 1.5);
                    melodyIndex = (melodyIndex + 1) % melodyPattern.length;
                }

                chordIndex = (chordIndex + 1) % chordProgression.length;

                if (isMusicPlaying) {
                    setTimeout(scheduleNextSection, chordDuration * 1000 - 100);
                }
            }

            scheduleNextSection();
        }

        function stopBackgroundMusic() {
            isMusicPlaying = false;
            backgroundMusicNodes.forEach(node => {
                try {
                    if (node.osc) node.osc.stop();
                } catch (e) {}
            });
            backgroundMusicNodes = [];
        }
        
        function playSound(type) {
            if (!soundEffectsEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'correct':
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1046.50, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'wrong':
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'complete':
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                    break;
                case 'click':
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;
                case 'locked':
                    oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.15);
                    break;
            }
        }

        function playWarpSound() {
            if (!soundEffectsEnabled) return;
            
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator1.type = 'sawtooth';
            oscillator2.type = 'triangle';
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(200, audioContext.currentTime);
            filter.frequency.exponentialRampToValueAtTime(2000, audioContext.currentTime + 1.5);
            
            oscillator1.frequency.setValueAtTime(80, audioContext.currentTime);
            oscillator1.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 1.5);
            
            oscillator2.frequency.setValueAtTime(120, audioContext.currentTime);
            oscillator2.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 1.5);
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.15, audioContext.currentTime + 1.2);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2.5);
            
            oscillator1.connect(filter);
            oscillator2.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator1.start(audioContext.currentTime);
            oscillator2.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + 2.5);
            oscillator2.stop(audioContext.currentTime + 2.5);
        }

        function createParticles(x, y, color) {
            const container = document.getElementById('app');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = color;
                container.appendChild(particle);
                
                const angle = (Math.PI * 2 * i) / 20;
                const velocity = 2 + Math.random() * 3;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;
                
                let posX = x;
                let posY = y;
                let life = 1;
                
                const animate = () => {
                    posX += vx;
                    posY += vy;
                    life -= 0.02;
                    
                    particle.style.left = posX + 'px';
                    particle.style.top = posY + 'px';
                    particle.style.opacity = life;
                    
                    if (life > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        particle.remove();
                    }
                };
                
                animate();
            }
        }

        function createTrail(x, y) {
            const trail = document.createElement('div');
            trail.className = 'trail';
            trail.style.left = x + 'px';
            trail.style.top = y + 'px';
            document.getElementById('app').appendChild(trail);
            setTimeout(() => trail.remove(), 800);
        }

        function createStars() {
            let starsHtml = '';
            for (let i = 0; i < 100; i++) {
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const delay = Math.random() * 3;
                starsHtml += `<div class="star" style="left: ${x}%; top: ${y}%; animation-delay: ${delay}s;"></div>`;
            }
            
            starsHtml += `
                <div class="nebula" style="top: 10%; left: 20%; background: radial-gradient(circle, rgba(138,43,226,0.3), transparent);"></div>
                <div class="nebula" style="top: 60%; left: 70%; background: radial-gradient(circle, rgba(0,191,255,0.3), transparent); animation-delay: 5s;"></div>
                <div class="nebula" style="top: 80%; left: 30%; background: radial-gradient(circle, rgba(255,20,147,0.3), transparent); animation-delay: 10s;"></div>
            `;
            
            return starsHtml;
        }

        function adjustBrightness(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 + 
                   (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255))
                   .toString(16).slice(1);
        }

        function createShootingStar() {
            const star = document.createElement('div');
            star.className = 'shooting-star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 50 + '%';
            star.style.animation = 'shoot 1s linear';
            document.getElementById('app').appendChild(star);
            
            setTimeout(() => star.remove(), 1000);
        }

        setInterval(() => {
            if (Math.random() > 0.7) {
                createShootingStar();
            }
        }, 3000);

        function renderMenu() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            const menuPlanets = [
                { color: '#ff8c00', size: 80, top: '15%', left: '10%', delay: 0, speed: 4 },
                { color: '#00a8ff', size: 60, top: '70%', left: '15%', delay: 1, speed: 5 },
                { color: '#00e676', size: 70, top: '25%', left: '85%', delay: 2, speed: 4.5 },
                { color: '#9c27b0', size: 50, top: '80%', left: '80%', delay: 0.5, speed: 5.5 },
                { color: '#f44336', size: 65, top: '60%', left: '90%', delay: 1.5, speed: 4.2 },
                { color: '#ffd700', size: 90, top: '10%', left: '75%', delay: 0.8, speed: 3.8 }
            ];

            let planetsHtml = '';
            menuPlanets.forEach((p, i) => {
                const hasRing = i === 2 || i === 5;
                planetsHtml += `
                    <div class="absolute" style="top: ${p.top}; left: ${p.left}; width: ${p.size}px; height: ${p.size}px; animation: float ${p.speed}s ease-in-out infinite; animation-delay: ${p.delay}s; opacity: 0.6;">
                        <div class="planet-sphere w-full h-full" style="background: radial-gradient(circle at 30% 30%, ${p.color}, ${adjustBrightness(p.color, -30)}); box-shadow: 0 0 30px ${p.color}, inset -10px -10px 30px rgba(0,0,0,.5);">
                            ${hasRing ? `<div class="planet-ring" style="border-color: ${p.color}; width: 140%; height: 30%; border-width: 2px;"></div>` : ''}
                        </div>
                    </div>
                `;
            });

            return `
                <div class="h-full w-full flex items-center justify-center relative" style="background: ${config.background_color};">
                    ${createStars()}
                    ${planetsHtml}
                    
                    <div class="absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%); animation: float 3s ease-in-out infinite; font-size: 120px; opacity: 0.15; z-index: 5;">
                        üöÄ
                    </div>

                    <div class="text-center z-10 px-4">
                        <div class="mb-8" style="position: relative;">
                            <div style="font-size: 80px; margin-bottom: -20px; animation: pulse 2s infinite;">üåå</div>
                            <h1 class="font-bold" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 3}px; color: ${config.primary_color}; text-shadow: 0 0 30px ${config.primary_color}, 0 0 60px ${config.primary_color}; animation: pulse 2s infinite;">
                                ${config.game_title}
                            </h1>
                            <p style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; color: ${config.text_color}; opacity: 0.8; margin-top: 8px;">
                                üéØ Petualangan Geometri Bangun Ruang
                            </p>
                        </div>
                        
                        <div class="mb-6 px-6 py-4 rounded-2xl mx-auto inline-block" style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
                            <p style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.primary_color}; font-weight: bold; margin-bottom: 8px;">
                                üë• Dibuat oleh Kelompok 6
                            </p>
                            <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.75}px; color: ${config.text_color}; opacity: 0.9; text-align: left;">
                                <p>1. Ananda Aulia - 2023121002</p>
                                <p>2. Intan Cahyani - 2023121001</p>
                                <p>3. Aisyah Dwi Angraini - 2023121015</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <button onclick="playSound('click'); startGame(false)" class="px-8 py-4 rounded-full font-bold text-white transition-all hover:scale-110 active:scale-95" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; background: ${config.button_color}; box-shadow: 0 4px 30px rgba(99, 102, 241, 0.6), 0 0 20px ${config.button_color};">
                                üöÄ ${config.start_button_text}
                            </button>
                            <button onclick="playSound('click'); startGame(true)" class="px-8 py-4 rounded-full font-bold text-white transition-all hover:scale-110 active:scale-95" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; background: linear-gradient(135deg, #ff0000, #ff8c00, #ffd700); box-shadow: 0 4px 30px rgba(255, 0, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.5); animation: pulse 2s infinite;">
                                ‚ö° GOD MODE
                            </button>
                            <button onclick="playSound('click'); showGuide()" class="block mx-auto px-8 py-4 rounded-full font-bold transition-all hover:scale-110 active:scale-95" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; background: ${config.secondary_color}; color: ${config.background_color}; box-shadow: 0 4px 20px rgba(0, 212, 255, 0.4);">
                                üìñ ${config.guide_button_text}
                            </button>
                            <div class="mt-6 px-6 py-3 rounded-2xl mx-auto inline-block" style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);">
                                <p style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color}; opacity: 0.9;">
                                    ‚≠ê 7 Planet Bangun Ruang ‚Ä¢ üéØ 35 Soal ‚Ä¢ ‚ù§Ô∏è 3 Nyawa
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGuide() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;
            const isGodMode = gameState.godMode;

            if (isGodMode) {
                return `
                    <div class="h-full w-full flex items-center justify-center relative overflow-auto" style="background: ${config.background_color};">
                        ${createStars()}
                        <div class="z-10 px-6 py-8 max-w-2xl rounded-3xl mx-4" style="background: linear-gradient(135deg, rgba(255, 0, 0, 0.2), rgba(255, 215, 0, 0.2)); backdrop-filter: blur(10px); border: 2px solid ${config.primary_color};">
                            <h2 class="font-bold mb-6 text-center" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2}px; color: #ff0000; text-shadow: 0 0 20px #ff0000; animation: pulse 2s infinite;">
                                ‚ö° GOD MODE ‚ö°
                            </h2>
                            <div class="space-y-4" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; color: ${config.text_color};">
                                <p>‚ö†Ô∏è <strong style="color: #ff0000;">MODE EKSTRIM!</strong> Tantangan ultimate untuk para master geometri!</p>
                                <p>‚è±Ô∏è <strong>Timer:</strong> Kamu punya HANYA 10 MENIT untuk menyelesaikan SEMUA 7 planet!</p>
                                <p>üíÄ <strong>Nyawa Permanen:</strong> Nyawa TIDAK akan reset setelah selesai planet. Nyawa habis = Game Over!</p>
                                <p>üí• <strong>Konsekuensi:</strong> Waktu habis atau nyawa habis = SEMUA PLANET MELEDAK!</p>
                                <p>üî• <strong>Tantangan:</strong> 35 soal, 3 nyawa, 10 menit. Hanya yang terbaik yang bisa menang!</p>
                                <p style="text-align: center; margin-top: 20px; font-size: ${baseSize * 1.125}px; color: #ffd700;"><strong>Apakah kamu siap menghadapi tantangan ini?</strong></p>
                            </div>
                            <div class="flex gap-4 mt-6 justify-center">
                                <button onclick="playSound('click'); gameState.godMode = false; backToMenu()" class="px-6 py-3 rounded-full font-bold hover:scale-105 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; background: #666; color: ${config.text_color};">
                                    ‚Üê Kembali
                                </button>
                                <button onclick="playSound('click'); confirmGodMode()" class="px-8 py-3 rounded-full font-bold hover:scale-105 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; background: linear-gradient(135deg, #ff0000, #ffd700); color: ${config.text_color}; box-shadow: 0 0 20px #ff0000;">
                                    ‚ö° MULAI GOD MODE!
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="h-full w-full flex items-center justify-center relative overflow-auto" style="background: ${config.background_color};">
                    ${createStars()}
                    <div class="z-10 px-6 py-8 max-w-2xl rounded-3xl mx-4" style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);">
                        <h2 class="font-bold mb-6 text-center" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2}px; color: ${config.primary_color};">
                            üöÄ Panduan Misi
                        </h2>
                        <div class="space-y-4" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; color: ${config.text_color};">
                            <p>üéØ <strong>Tujuan:</strong> Selamatkan galaksi dengan menyelesaikan soal bangun ruang!</p>
                            <p>‚ù§Ô∏è <strong>Nyawa:</strong> Kamu punya 3 nyawa. Jawaban salah mengurangi 1 nyawa.</p>
                            <p>ü™ê <strong>Planet:</strong> Ada 7 planet bangun ruang dengan soal geometri.</p>
                            <p>üìù <strong>Cara Bermain:</strong> Jawab 5 soal di setiap planet untuk membuka planet berikutnya.</p>
                            <p>‚≠ê <strong>Kelebihan:</strong> Tidak ada batasan waktu, bermain dengan santai!</p>
                        </div>
                        <button onclick="playSound('click'); backToMenu()" class="mt-6 px-6 py-3 rounded-full font-bold mx-auto block hover:scale-105 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; background: ${config.button_color}; color: ${config.text_color};">
                            Kembali
                        </button>
                    </div>
                </div>
            `;
        }

        function renderStoryOpening() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            return `
                <div class="h-full w-full flex items-center justify-center relative overflow-auto" style="background: ${config.background_color};">
                    ${createStars()}
                    
                    <div class="absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.1; font-size: 400px; animation: pulse 3s infinite;">
                        üåå
                    </div>

                    <div class="z-10 w-full max-w-4xl px-6 py-8">
                        <div class="rounded-3xl p-10 text-center" style="background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); border: 3px solid ${config.primary_color}; box-shadow: 0 0 60px ${config.primary_color};">
                            
                            <div class="text-8xl mb-8" style="animation: dangerBlink 1s infinite;">‚ö†Ô∏è</div>
                            
                            <h2 class="font-bold mb-8" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.5}px; color: #ff0000; text-shadow: 0 0 30px #ff0000; animation: pulse 1.5s infinite;">
                                üö® ${config.crisis_title} üö®
                            </h2>
                            
                            <div class="space-y-6 mb-10" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.125}px; color: ${config.text_color}; line-height: 1.8; text-align: left;">
                                <p><strong style="color: ${config.primary_color};">üì° LAPORAN DARURAT:</strong></p>
                                <p>Virus geometri menyerang 7 planet bangun ruang di Galaksi! Semua bentuk geometris rusak dan planet-planet terancam hancur.</p>
                                
                                <p><strong style="color: ${config.primary_color};">üéØ MISI KAMU:</strong></p>
                                <p>Sebagai pilot roket terakhir yang tersisa, kamu harus menyelamatkan setiap planet dengan memecahkan soal bangun ruang!</p>
                                
                                <p><strong style="color: ${config.primary_color};">‚ö†Ô∏è PERHATIAN:</strong></p>
                                <p>‚Ä¢ Setiap planet punya masalah geometri unik yang harus diselesaikan</p>
                                <p>‚Ä¢ Kamu hanya punya 3 nyawa untuk menyelamatkan semua planet</p>
                                <p>‚Ä¢ Planet yang gagal diselamatkan akan meledak selamanya!</p>
                                
                                <p class="text-center mt-8" style="font-size: ${baseSize * 1.5}px; color: ${config.primary_color}; font-weight: bold;">
                                    üí´ Masa depan Galaksi Bangun Ruang ada di tanganmu! üí´
                                </p>
                            </div>
                            
                            <button onclick="playSound('click'); proceedToMap()" class="px-10 py-5 rounded-full font-bold hover:scale-110 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; background: linear-gradient(135deg, ${config.button_color}, ${config.secondary_color}); color: ${config.text_color}; box-shadow: 0 0 40px ${config.button_color}; animation: pulse 2s infinite;">
                                üöÄ ${config.mission_button}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGalaxyMap() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            const hearts = '‚ù§Ô∏è'.repeat(gameState.lives);

            const positions = [
                { top: '15%', left: '20%' },
                { top: '30%', left: '50%' },
                { top: '20%', left: '75%' },
                { top: '50%', left: '65%' },
                { top: '65%', left: '40%' },
                { top: '75%', left: '15%' },
                { top: '50%', left: '50%' }
            ];

            let spaceshipPosition = positions[0];
            if (gameState.completedPlanets.length > 0) {
                const lastCompleted = gameState.completedPlanets[gameState.completedPlanets.length - 1];
                if (lastCompleted + 1 < planets.length) {
                    spaceshipPosition = positions[lastCompleted + 1];
                } else {
                    spaceshipPosition = positions[lastCompleted];
                }
            }

            let pathsHtml = '<svg class="absolute inset-0 w-full h-full pointer-events-none" style="z-index: 1;">';
            for (let i = 0; i < planets.length - 1; i++) {
                const isPathActive = gameState.completedPlanets.includes(i);
                const pathColor = isPathActive ? config.primary_color : 'rgba(255,255,255,0.2)';
                const pathClass = isPathActive ? 'orbit-line active' : 'orbit-line';
                
                pathsHtml += `
                    <line class="${pathClass}" x1="${positions[i].left}" y1="${positions[i].top}" 
                          x2="${positions[i + 1].left}" y2="${positions[i + 1].top}" 
                          stroke="${pathColor}" style="color: ${pathColor};" />
                `;
            }
            pathsHtml += '</svg>';

            let planetsHtml = '';
            planets.forEach((planet, index) => {
                const isUnlocked = index === 0 || gameState.completedPlanets.includes(index - 1);
                const isCompleted = gameState.completedPlanets.includes(index);
                const isActive = isUnlocked && !isCompleted;
                const lockedClass = !isUnlocked ? 'locked' : '';
                const completedClass = isCompleted ? 'completed' : '';
                const activeClass = isActive ? 'active' : '';

                const hasRing = index === 2 || index === 5;
                const tooltipText = !isUnlocked ? 'Selesaikan planet sebelumnya' : planet.name;
                
                planetsHtml += `
                    <div class="planet-icon ${lockedClass} ${completedClass} ${activeClass} absolute" 
                         style="top: ${positions[index].top}; left: ${positions[index].left}; transform: translate(-50%, -50%); z-index: 10;" 
                         onclick="${isUnlocked ? `handlePlanetClick(${index})` : `handleLockedClick(${index})`}">
                        <div class="tooltip">${tooltipText}</div>
                        <div class="planet-icon-inner w-28 h-28" style="animation: float 3s ease-in-out infinite; animation-delay: ${index * 0.5}s;">
                            <div class="planet-sphere w-full h-full" style="background: radial-gradient(circle at 30% 30%, ${planet.color}, ${adjustBrightness(planet.color, -30)}); box-shadow: 0 0 ${isActive ? '50px' : '40px'} ${planet.color}, inset -15px -15px 40px rgba(0,0,0,.5);">
                                ${hasRing ? `<div class="planet-ring" style="border-color: ${planet.color};"></div>` : ''}
                            </div>
                            <div class="material-icon">${planet.icon}</div>
                            ${isCompleted ? `<div class="completion-ring" style="border-color: ${config.primary_color};"></div>` : ''}
                            ${isCompleted ? '<div class="absolute -top-3 -right-3 text-4xl z-20" style="animation: pulse 1s infinite;">‚≠ê</div>' : ''}
                            ${!isUnlocked ? `<div id="lock-${index}" class="absolute inset-0 flex items-center justify-center text-5xl z-20" style="text-shadow: 0 0 10px black; opacity: 0.8;">üîí</div>` : ''}
                        </div>
                        <p class="text-center mt-3 font-bold" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color}; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                            ${planet.name}
                        </p>
                    </div>
                `;
            });

            let spaceshipHtml = `
                <div id="spaceship" class="spaceship" style="top: ${spaceshipPosition.top}; left: ${spaceshipPosition.left}; transform: translate(-50%, -50%);">
                    üöÄ
                </div>
            `;

            const allCompleted = gameState.completedPlanets.length === 7;

            return `
                <div class="h-full w-full relative" style="background: ${config.background_color};">
                    ${createStars()}
                    <div class="absolute top-4 left-4 z-20 flex flex-col gap-2" style="animation: uiFadeIn 0.8s ease-out forwards; opacity: 0;">
                        <div class="px-4 py-2 rounded-full" style="background: rgba(255, 255, 255, 0.2); font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; color: ${config.text_color};">
                            <span class="heart">${hearts}</span>
                        </div>
                        ${gameState.godMode ? `
                        <div id="timerDisplay" class="px-4 py-2 rounded-full ${gameState.timeRemaining <= 60 ? 'animate-pulse' : ''}" style="background: ${gameState.timeRemaining <= 60 ? 'rgba(255, 0, 0, 0.3)' : 'rgba(255, 215, 0, 0.2)'}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.125}px; color: ${gameState.timeRemaining <= 60 ? '#ff0000' : config.primary_color}; font-weight: bold; border: 2px solid ${gameState.timeRemaining <= 60 ? '#ff0000' : config.primary_color};">
                            ‚è±Ô∏è ${formatTime(gameState.timeRemaining)}
                        </div>
                        ` : ''}
                    </div>
                    <div class="absolute top-4 right-4 z-20 flex gap-3" style="animation: uiFadeIn 0.8s ease-out forwards; animation-delay: 0.2s; opacity: 0;">
                        <button onclick="toggleMusic()" class="px-4 py-2 rounded-full font-bold hover:scale-105 transition-all" style="background: rgba(255, 255, 255, 0.2); color: ${config.text_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px;">
                            <span id="musicIcon">${isMusicPlaying ? 'üîä' : 'üîá'}</span>
                        </button>
                        <button onclick="toggleSoundEffects()" class="px-4 py-2 rounded-full font-bold hover:scale-105 transition-all" style="background: rgba(255, 255, 255, 0.2); color: ${config.text_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px;">
                            <span id="sfxIcon">${soundEffectsEnabled ? 'üéµ' : 'üîà'}</span>
                        </button>
                        <button onclick="playSound('click'); backToMenu()" class="px-6 py-2 rounded-full font-bold hover:scale-105 transition-all" style="background: ${config.secondary_color}; color: ${config.background_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px;">
                            üè† Menu Utama
                        </button>
                        ${allCompleted ? `
                        <button onclick="fullReset()" class="px-6 py-2 rounded-full font-bold hover:scale-105 transition-all" style="background: ${config.button_color}; color: ${config.text_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px;">
                            üîÑ Reset Progress
                        </button>
                        ` : ''}
                    </div>
                    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-20 px-6 py-3 rounded-2xl" style="background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px); animation: uiFadeIn 0.8s ease-out forwards; animation-delay: 0.4s; opacity: 0;">
                        <p class="text-center" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color};">
                            üéØ Selesaikan misi untuk membuka planet berikutnya
                        </p>
                    </div>
                    <div class="h-full w-full relative">
                        ${pathsHtml}
                        ${planetsHtml}
                        ${spaceshipHtml}
                    </div>
                </div>
            `;
        }

        function renderStoryIntro() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            const planet = planets[gameState.currentPlanet];

            return `
                <div class="h-full w-full flex items-center justify-center relative" style="background: ${config.background_color};">
                    ${createStars()}
                    <div class="z-10 w-full max-w-3xl px-6">
                        <div class="rounded-3xl p-8 text-center" style="background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); border: 3px solid ${planet.color}; box-shadow: 0 0 50px ${planet.color};">
                            <div class="w-40 h-40 mx-auto mb-6 relative" style="animation: float 3s ease-in-out infinite;">
                                <div class="planet-sphere w-full h-full flex items-center justify-center" style="background: radial-gradient(circle at 30% 30%, ${planet.color}, ${adjustBrightness(planet.color, -30)}); box-shadow: 0 0 60px ${planet.color}, inset -25px -25px 50px rgba(0,0,0,.5);">
                                    <div class="material-icon" style="font-size: 80px;">
                                        ${planet.icon}
                                    </div>
                                </div>
                            </div>
                            <h2 class="font-bold mb-6" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2}px; color: ${planet.color}; text-shadow: 0 0 20px ${planet.color};">
                                ${planet.name}
                            </h2>
                            <p class="mb-8 whitespace-pre-line leading-relaxed" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.125}px; color: ${config.text_color};">
                                ${planet.story.intro}
                            </p>
                            <button onclick="playSound('click'); startPlanetMission()" class="px-8 py-4 rounded-full font-bold hover:scale-110 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; background: ${planet.color}; color: #000000; box-shadow: 0 0 30px ${planet.color}; animation: pulse 2s infinite;">
                                üöÄ Mulai Misi!
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPlanetChallenge() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            const planet = planets[gameState.currentPlanet];
            const question = planet.questions[gameState.currentQuestion];
            const hearts = '‚ù§Ô∏è'.repeat(gameState.lives);
            const progressCount = gameState.currentQuestion;

            if (!question.shuffled) {
                const answersWithIndex = question.answers.map((answer, index) => ({ answer, originalIndex: index }));
                
                for (let i = answersWithIndex.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [answersWithIndex[i], answersWithIndex[j]] = [answersWithIndex[j], answersWithIndex[i]];
                }
                
                question.shuffledAnswers = answersWithIndex;
                question.shuffled = true;
            }

            let answersHtml = '';
            question.shuffledAnswers.forEach(({ answer, originalIndex }) => {
                answersHtml += `
                    <button onclick="checkAnswer(${originalIndex})" class="answer-btn w-full px-6 py-4 rounded-2xl font-bold hover:scale-105 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; background: ${config.button_color}; color: ${config.text_color}; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);">
                        ${answer}
                    </button>
                `;
            });

            let interactiveVisual = '';
            const visualType = planet.story.visual;
            const progressPercent = (progressCount / 5) * 100;
            
            if (visualType === 'rocket') {
                interactiveVisual = `
                    <div class="mb-6">
                        <div class="text-center mb-2" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color};">
                            ‚ö° ${planet.story.progress}: ${progressCount}/5
                        </div>
                        <div class="w-full h-6 rounded-full overflow-hidden" style="background: rgba(0, 0, 0, 0.5);">
                            <div id="energyBar" class="h-full transition-all duration-500" style="width: ${progressPercent}%; background: linear-gradient(90deg, #ff8c00, #ffd700); box-shadow: 0 0 20px #ff8c00;"></div>
                        </div>
                        <div class="text-center mt-4" style="font-size: 80px; filter: drop-shadow(0 0 20px ${progressPercent > 0 ? '#ff8c00' : 'rgba(255,255,255,0.3)'}); opacity: ${0.3 + (progressPercent / 100) * 0.7}; transition: all 0.5s;">
                            üöÄ
                        </div>
                    </div>
                `;
            } else if (visualType === 'crystal') {
                interactiveVisual = `
                    <div class="mb-6">
                        <div class="text-center mb-2" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color};">
                            üíé ${planet.story.progress}: ${progressCount}/5
                        </div>
                        <div class="flex justify-center gap-3 mb-4">
                            ${Array(5).fill(0).map((_, i) => `
                                <div style="font-size: 50px; filter: drop-shadow(0 0 ${i < progressCount ? '15px' : '0px'} #00a8ff); opacity: ${i < progressCount ? '1' : '0.3'}; transition: all 0.5s;">
                                    üíé
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (visualType === 'balance') {
                interactiveVisual = `
                    <div class="mb-6">
                        <div class="text-center mb-2" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color};">
                            ‚öñÔ∏è ${planet.story.progress}: ${progressCount}/5
                        </div>
                        <div class="flex justify-center gap-3 mb-4">
                            ${Array(5).fill(0).map((_, i) => `
                                <div style="font-size: 40px; filter: drop-shadow(0 0 ${i < progressCount ? '10px' : '0px'} #00e676); opacity: ${i < progressCount ? '1' : '0.3'}; transition: all 0.5s;">
                                    ‚öñÔ∏è
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (visualType === 'building') {
                interactiveVisual = `
                    <div class="mb-6">
                        <div class="text-center mb-2" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color};">
                            üèóÔ∏è ${planet.story.progress}: ${progressCount}/5
                        </div>
                        <div class="flex justify-center items-end gap-2 mb-4" style="height: 100px;">
                            ${Array(5).fill(0).map((_, i) => `
                                <div style="width: 40px; height: ${i < progressCount ? (20 + i * 15) + 'px' : '10px'}; background: ${i < progressCount ? 'linear-gradient(180deg, #9c27b0, #6a1b9a)' : 'rgba(156, 39, 176, 0.2)'}; border-radius: 4px; transition: all 0.5s; box-shadow: ${i < progressCount ? '0 0 15px #9c27b0' : 'none'};"></div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (visualType === 'door') {
                interactiveVisual = `
                    <div class="mb-6">
                        <div class="text-center mb-2" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color};">
                            üîê ${planet.story.progress}: ${progressCount}/5
                        </div>
                        <div class="flex justify-center gap-3 mb-4">
                            ${Array(5).fill(0).map((_, i) => `
                                <div style="font-size: 40px; transition: all 0.5s;">
                                    ${i < progressCount ? 'üîì' : 'üîí'}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (visualType === 'antenna') {
                interactiveVisual = `
                    <div class="mb-6">
                        <div class="text-center mb-2" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color};">
                            üì° ${planet.story.progress}: ${progressCount}/5
                        </div>
                        <div class="w-full h-6 rounded-full overflow-hidden" style="background: rgba(0, 0, 0, 0.5);">
                            <div class="h-full transition-all duration-500" style="width: ${progressPercent}%; background: linear-gradient(90deg, #ffeb3b, #ffc107); box-shadow: 0 0 20px #ffeb3b;"></div>
                        </div>
                        <div class="text-center mt-4" style="font-size: 60px; filter: drop-shadow(0 0 ${progressPercent > 0 ? '20px' : '0px'} #ffeb3b); transition: all 0.5s;">
                            üì°
                        </div>
                    </div>
                `;
            } else if (visualType === 'computer') {
                interactiveVisual = `
                    <div class="mb-6">
                        <div class="text-center mb-2" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color};">
                            üß† ${planet.story.progress}: ${progressCount}/5
                        </div>
                        <div class="w-full h-6 rounded-full overflow-hidden" style="background: rgba(0, 0, 0, 0.5);">
                            <div class="h-full transition-all duration-500" style="width: ${progressPercent}%; background: linear-gradient(90deg, #ffd700, #ff8c00); box-shadow: 0 0 20px #ffd700;"></div>
                        </div>
                        <div class="text-center mt-4" style="font-size: 60px; filter: drop-shadow(0 0 ${progressPercent > 0 ? '20px' : '0px'} #ffd700); transition: all 0.5s;">
                            üíª
                        </div>
                    </div>
                `;
            }

            return `
                <div class="h-full w-full flex items-center justify-center relative" style="background: ${config.background_color};">
                    ${createStars()}
                    <div class="absolute top-4 left-4 z-20 flex flex-col gap-2">
                        <div class="px-4 py-2 rounded-full" style="background: rgba(255, 255, 255, 0.2); font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.125}px; color: ${config.text_color};">
                            <span class="heart">${hearts}</span>
                        </div>
                        ${gameState.godMode ? `
                        <div id="timerDisplay" class="px-4 py-2 rounded-full ${gameState.timeRemaining <= 60 ? 'animate-pulse' : ''}" style="background: ${gameState.timeRemaining <= 60 ? 'rgba(255, 0, 0, 0.3)' : 'rgba(255, 215, 0, 0.2)'}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.125}px; color: ${gameState.timeRemaining <= 60 ? '#ff0000' : config.primary_color}; font-weight: bold; border: 2px solid ${gameState.timeRemaining <= 60 ? '#ff0000' : config.primary_color};">
                            ‚è±Ô∏è ${formatTime(gameState.timeRemaining)}
                        </div>
                        ` : ''}
                    </div>
                    <div class="absolute top-4 right-4 z-20 flex gap-3">
                        <button onclick="playSound('click'); gameState.screen = 'map'; render();" class="px-6 py-2 rounded-full font-bold hover:scale-105 transition-all" style="background: ${config.secondary_color}; color: ${config.background_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px;">
                            ‚Üê Kembali
                        </button>
                        <button onclick="playSound('click'); backToMenu()" class="px-6 py-2 rounded-full font-bold hover:scale-105 transition-all" style="background: rgba(255, 255, 255, 0.2); color: ${config.text_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px;">
                            üè† Menu
                        </button>
                    </div>
                    <div class="z-10 w-full max-w-2xl px-6">
                        <div class="rounded-3xl p-8" style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 2px solid ${planet.color};">
                            ${interactiveVisual}
                            <div class="mb-6 p-6 rounded-2xl" style="background: rgba(0, 0, 0, 0.3);">
                                <p class="text-center font-bold" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; color: ${config.text_color};">
                                    ${question.q}
                                </p>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                ${answersHtml}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGameOver() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            const currentPlanetName = planets[gameState.currentPlanet].name;
            const completedCount = gameState.completedPlanets.length;

            return `
                <div class="h-full w-full flex items-center justify-center relative" style="background: ${config.background_color};">
                    ${createStars()}
                    <div class="text-center z-10 px-4">
                        <div class="text-9xl mb-6">üí•</div>
                        <h2 class="font-bold mb-4" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.5}px; color: #f44336;">
                            Planet ${currentPlanetName} Gagal!
                        </h2>
                        <p class="mb-4" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; color: ${config.text_color};">
                            Jangan menyerah! Coba lagi planet ini!
                        </p>
                        <p class="mb-8" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; color: ${config.primary_color};">
                            ‚úÖ Progress tersimpan: ${completedCount} planet selesai
                        </p>
                        <div class="flex gap-4 justify-center">
                            <button onclick="playSound('click'); retryCurrentPlanet()" class="px-8 py-4 rounded-full font-bold hover:scale-105 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; background: ${config.button_color}; color: ${config.text_color};">
                                üîÑ Ulangi ${currentPlanetName}
                            </button>
                            <button onclick="playSound('click'); backToMapFromGameOver()" class="px-8 py-4 rounded-full font-bold hover:scale-105 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; background: ${config.secondary_color}; color: ${config.background_color};">
                                üó∫Ô∏è Kembali ke Map
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderVictory() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            const isGodMode = gameState.godMode;
            
            const orbitRadius = 180;
            const centerX = 50;
            const centerY = 50;
            
            let planetsOrbiting = '';
            planets.forEach((planet, index) => {
                const angle = (index * 360 / 7) - 90;
                const x = centerX + (orbitRadius * Math.cos(angle * Math.PI / 180));
                const y = centerY + (orbitRadius * Math.sin(angle * Math.PI / 180));
                const delay = index * 0.15;
                
                planetsOrbiting += `
                    <div class="absolute" style="left: ${x}%; top: ${y}%; transform: translate(-50%, -50%); animation: float 3s ease-in-out infinite, galaxyFadeIn 1s ease-out forwards; animation-delay: ${delay}s, ${delay}s; opacity: 0;">
                        <div class="relative" style="width: 60px; height: 60px;">
                            <div class="planet-sphere w-full h-full" style="background: radial-gradient(circle at 30% 30%, ${planet.color}, ${adjustBrightness(planet.color, -30)}); box-shadow: 0 0 30px ${planet.color}, inset -10px -10px 20px rgba(0,0,0,.5);">
                                ${(index === 2 || index === 5) ? `<div class="planet-ring" style="border-color: ${planet.color}; width: 140%; height: 30%;"></div>` : ''}
                            </div>
                            <div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 30px; filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));">
                                ${planet.icon}
                            </div>
                            <div class="absolute -top-2 -right-2 text-2xl" style="animation: pulse 1s infinite;">‚≠ê</div>
                        </div>
                    </div>
                `;
            });

            return `
                <div class="h-full w-full flex items-center justify-center relative overflow-auto" style="background: ${config.background_color};">
                    ${createStars()}
                    
                    <div class="absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; height: 500px; animation: galaxyFadeIn 1.5s ease-out;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 150px; height: 150px; background: radial-gradient(circle, ${config.primary_color}, transparent); animation: pulse 3s infinite; opacity: 0.5;"></div>
                        
                        <div style="position: absolute; inset: 0;">
                            ${planetsOrbiting}
                        </div>
                        
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 100px; animation: pulse 2s infinite;">
                            üåå
                        </div>
                    </div>

                    <div class="absolute inset-0 flex flex-col items-center justify-center z-10 px-6" style="pointer-events: none;">
                        <div class="text-center max-w-3xl" style="pointer-events: auto; margin-top: 420px;">
                            <div class="rounded-3xl p-10 mb-6" style="background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(15px); border: 3px solid ${config.primary_color}; box-shadow: 0 0 50px ${config.primary_color}; animation: uiFadeIn 1s ease-out forwards; animation-delay: 1.5s; opacity: 0;">
                                
                                <div class="text-8xl mb-8" style="animation: pulse 1.5s infinite;">üåü</div>
                                
                                <h2 class="font-bold mb-8" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.5}px; color: ${config.primary_color}; text-shadow: 0 0 30px ${config.primary_color};">
                                    ${config.victory_message}
                                </h2>
                                
                                <div class="space-y-4 mb-10" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.125}px; color: ${config.text_color}; line-height: 1.8;">
                                    <p>‚ú® Galaksi Bangun Ruang berhasil diselamatkan!</p>
                                    <p>ü™ê Semua 7 planet bangun ruang pulih kembali</p>
                                    <p>üéØ 35 soal geometri diselesaikan</p>
                                    ${isGodMode ? `<p style="color: ${config.primary_color}; font-weight: bold;">‚è±Ô∏è Waktu Tersisa: ${formatTime(gameState.timeRemaining)}</p>` : ''}
                                    
                                    <p style="font-size: ${baseSize * 1.5}px; color: ${config.primary_color}; font-weight: bold; margin-top: 30px;">
                                        üôè Terima kasih sudah menyelamatkan galaksi! üôè
                                    </p>
                                </div>
                                
                                <button onclick="playSound('click'); backToMenu()" class="px-10 py-4 rounded-full font-bold hover:scale-110 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; background: ${config.button_color}; color: ${config.text_color}; box-shadow: 0 0 30px ${config.button_color};">
                                    üè† Kembali ke Menu Utama
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPlanetExplosion() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            return `
                <div class="h-full w-full flex items-center justify-center relative" style="background: #000000;">
                    ${createStars()}
                    <div class="text-center z-10 px-4">
                        <div class="text-9xl mb-6" style="animation: pulse 0.5s infinite;">üí•</div>
                        <h2 class="font-bold mb-4" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.5}px; color: #ff0000; text-shadow: 0 0 30px #ff0000; animation: wrongShake 0.5s infinite;">
                            PLANET MELEDAK!
                        </h2>
                        <p class="mb-8" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; color: ${config.text_color};">
                            ${gameState.lives <= 0 ? 'Nyawa habis! Semua planet hancur!' : 'Waktu habis! Galaksi Bangun Ruang musnah!'}
                        </p>
                        <button onclick="playSound('click'); resetGame()" class="px-8 py-4 rounded-full font-bold hover:scale-105 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; background: #ff0000; color: ${config.text_color};">
                            Coba Lagi
                        </button>
                    </div>
                </div>
            `;
        }

        function renderTransition() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            if (gameState.transitionPhase === 'start') {
                return `
                    <div class="h-full w-full flex items-center justify-center relative" style="background: ${config.background_color};">
                        ${createStars()}
                        <div class="absolute" style="top: 50%; left: 50%; font-size: 120px; z-index: 10; animation: rocketZoomIn 0.8s ease-out forwards;">
                            üöÄ
                        </div>
                    </div>
                `;
            } else if (gameState.transitionPhase === 'warp') {
                let warpLinesHtml = '';
                for (let i = 0; i < 30; i++) {
                    const left = Math.random() * 100;
                    const delay = Math.random() * 0.5;
                    warpLinesHtml += `
                        <div class="warp-line" style="left: ${left}%; animation-delay: ${delay}s; height: ${100 + Math.random() * 200}px;"></div>
                    `;
                }

                return `
                    <div class="h-full w-full relative overflow-hidden" style="background: radial-gradient(circle, #1a1a3e, #000000);">
                        ${warpLinesHtml}
                        <div class="absolute inset-0 flex items-center justify-center" style="font-size: 200px; opacity: 0.3; filter: blur(5px);">
                            üöÄ
                        </div>
                    </div>
                `;
            } else if (gameState.transitionPhase === 'arrive') {
                const positions = [
                    { top: '15%', left: '20%' },
                    { top: '30%', left: '50%' },
                    { top: '20%', left: '75%' },
                    { top: '50%', left: '65%' },
                    { top: '65%', left: '40%' },
                    { top: '75%', left: '15%' },
                    { top: '50%', left: '50%' }
                ];

                let planetsHtml = '';
                planets.forEach((planet, index) => {
                    const isUnlocked = index === 0;
                    const hasRing = index === 2 || index === 5;
                    
                    planetsHtml += `
                        <div class="absolute" style="top: ${positions[index].top}; left: ${positions[index].left}; transform: translate(-50%, -50%); animation: galaxyFadeIn 1s ease-out forwards; animation-delay: ${index * 0.1}s; opacity: 0;">
                            <div class="w-28 h-28 relative" style="animation: float 3s ease-in-out infinite; animation-delay: ${index * 0.5}s;">
                                <div class="planet-sphere w-full h-full" style="background: radial-gradient(circle at 30% 30%, ${planet.color}, ${adjustBrightness(planet.color, -30)}); box-shadow: 0 0 40px ${planet.color}, inset -15px -15px 40px rgba(0,0,0,.5);">
                                    ${hasRing ? `<div class="planet-ring" style="border-color: ${planet.color};"></div>` : ''}
                                </div>
                                <div class="material-icon">${planet.icon}</div>
                                ${!isUnlocked ? '<div class="absolute inset-0 flex items-center justify-center text-5xl z-20" style="text-shadow: 0 0 10px black;">üîí</div>' : ''}
                            </div>
                        </div>
                    `;
                });

                return `
                    <div class="h-full w-full relative" style="background: ${config.background_color};">
                        ${createStars()}
                        <div class="h-full w-full relative" style="animation: galaxyFadeIn 1s ease-out;">
                            ${planetsHtml}
                            <div class="absolute" style="top: ${positions[0].top}; left: ${positions[0].left}; transform: translate(-50%, -50%); font-size: 48px; z-index: 20; animation: galaxyFadeIn 0.8s ease-out forwards; animation-delay: 0.3s; opacity: 0;">
                                üöÄ
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function renderMissionSuccess() {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            const planet = planets[gameState.currentPlanet];

            return `
                <div class="h-full w-full flex items-center justify-center relative" style="background: ${config.background_color};">
                    ${createStars()}
                    <div class="z-10 w-full max-w-3xl px-6">
                        <div class="rounded-3xl p-8 text-center" style="background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); border: 3px solid ${planet.color}; box-shadow: 0 0 60px ${planet.color}; animation: pulse 2s infinite;">
                            <div class="text-9xl mb-6" style="animation: pulse 1s infinite;">üéâ</div>
                            <h2 class="font-bold mb-6" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.5}px; color: ${planet.color}; text-shadow: 0 0 30px ${planet.color};">
                                MISI SELESAI!
                            </h2>
                            <p class="mb-8 whitespace-pre-line leading-relaxed" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; color: ${config.text_color};">
                                ${planet.story.success}
                            </p>
                            <button onclick="playSound('complete'); completePlanetMission()" class="px-8 py-4 rounded-full font-bold hover:scale-110 transition-all" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; background: ${planet.color}; color: #000000; box-shadow: 0 0 30px ${planet.color};">
                                ‚ú® Lanjutkan Perjalanan
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            switch (gameState.screen) {
                case 'menu':
                    app.innerHTML = renderMenu();
                    break;
                case 'guide':
                    app.innerHTML = renderGuide();
                    break;
                case 'transition':
                    app.innerHTML = renderTransition();
                    break;
                case 'story_opening':
                    app.innerHTML = renderStoryOpening();
                    break;
                case 'map':
                    app.innerHTML = renderGalaxyMap();
                    break;
                case 'story_intro':
                    app.innerHTML = renderStoryIntro();
                    break;
                case 'planet':
                    app.innerHTML = renderPlanetChallenge();
                    break;
                case 'mission_success':
                    app.innerHTML = renderMissionSuccess();
                    break;
                case 'gameover':
                    app.innerHTML = renderGameOver();
                    break;
                case 'victory':
                    app.innerHTML = renderVictory();
                    break;
                case 'explosion':
                    app.innerHTML = renderPlanetExplosion();
                    break;
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState.timerInterval = setInterval(() => {
                gameState.timeRemaining--;
                
                if (gameState.timeRemaining <= 0) {
                    clearInterval(gameState.timerInterval);
                    gameState.timerInterval = null;
                    playSound('wrong');
                    gameState.screen = 'explosion';
                    render();
                    return;
                }
                
                const timerDisplay = document.getElementById('timerDisplay');
                if (timerDisplay) {
                    const customFont = config.font_family || defaultConfig.font_family;
                    const baseFontStack = 'Arial, sans-serif';
                    const baseSize = config.font_size || defaultConfig.font_size;
                    const isLowTime = gameState.timeRemaining <= 60;
                    
                    timerDisplay.className = `px-4 py-2 rounded-full ${isLowTime ? 'animate-pulse' : ''}`;
                    timerDisplay.style.background = isLowTime ? 'rgba(255, 0, 0, 0.3)' : 'rgba(255, 215, 0, 0.2)';
                    timerDisplay.style.color = isLowTime ? '#ff0000' : config.primary_color;
                    timerDisplay.style.borderColor = isLowTime ? '#ff0000' : config.primary_color;
                    timerDisplay.innerHTML = `‚è±Ô∏è ${formatTime(gameState.timeRemaining)}`;
                }
            }, 1000);
        }

        function stopTimer() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }
        }

        function startGame(godMode = false) {
            if (godMode) {
                gameState.screen = 'guide';
                gameState.godMode = true;
                render();
                return;
            }
            
            gameState = {
                screen: 'transition',
                lives: 3,
                currentPlanet: 0,
                currentQuestion: 0,
                completedPlanets: [],
                godMode: false,
                timeRemaining: 600,
                timerInterval: null,
                transitionPhase: 'start'
            };
            
            playBackgroundMusic();
            playWarpSound();
            render();
            
            setTimeout(() => {
                gameState.transitionPhase = 'warp';
                render();
            }, 800);
            
            setTimeout(() => {
                gameState.transitionPhase = 'arrive';
                render();
            }, 2000);
            
            setTimeout(() => {
                const app = document.getElementById('app');
                const transitionOverlay = document.createElement('div');
                transitionOverlay.style.cssText = `
                    position: absolute;
                    inset: 0;
                    background: ${config.background_color};
                    opacity: 1;
                    transition: opacity 0.8s ease-out;
                    pointer-events: none;
                    z-index: 100;
                `;
                
                gameState.screen = 'story_opening';
                gameState.transitionPhase = null;
                render();
                
                app.appendChild(transitionOverlay);
                
                setTimeout(() => {
                    transitionOverlay.style.opacity = '0';
                    setTimeout(() => transitionOverlay.remove(), 800);
                }, 50);
            }, 3200);
        }

        function proceedToMap() {
            gameState.screen = 'map';
            render();
        }

        function confirmGodMode() {
            gameState.screen = 'story_opening';
            render();
        }

        function showGuide() {
            gameState.screen = 'guide';
            render();
        }

        function backToMenu() {
            stopTimer();
            gameState.screen = 'menu';
            gameState.godMode = false;
            render();
        }

        function handlePlanetClick(index) {
            playSound('click');
            gameState.currentPlanet = index;
            gameState.currentQuestion = 0;
            gameState.screen = 'story_intro';
            render();
        }

        function startPlanetMission() {
            gameState.screen = 'planet';
            
            if (gameState.godMode && !gameState.timerInterval) {
                startTimer();
            }
            
            render();
        }

        function completePlanetMission() {
            gameState.completedPlanets.push(gameState.currentPlanet);
            
            if (!gameState.godMode) {
                gameState.lives = 3;
            }
            
            if (gameState.completedPlanets.length === 7) {
                stopTimer();
                gameState.screen = 'victory';
                render();
            } else {
                gameState.screen = 'map';
                render();
                setTimeout(() => {
                    moveSpaceship(gameState.currentPlanet, gameState.currentPlanet + 1);
                }, 100);
            }
        }

        function handleLockedClick(index) {
            playSound('locked');
            const lockElement = document.getElementById(`lock-${index}`);
            if (lockElement) {
                lockElement.style.animation = 'lockedShake 0.5s ease';
                setTimeout(() => {
                    lockElement.style.animation = '';
                }, 500);
            }
        }

        function moveSpaceship(fromIndex, toIndex) {
            const positions = [
                { top: '15%', left: '20%' },
                { top: '30%', left: '50%' },
                { top: '20%', left: '75%' },
                { top: '50%', left: '65%' },
                { top: '65%', left: '40%' },
                { top: '75%', left: '15%' },
                { top: '50%', left: '50%' }
            ];

            const spaceship = document.getElementById('spaceship');
            if (!spaceship) return;

            const fromPos = positions[fromIndex];
            const toPos = positions[toIndex];

            const trailInterval = setInterval(() => {
                const rect = spaceship.getBoundingClientRect();
                createTrail(rect.left + rect.width / 2, rect.top + rect.height / 2);
            }, 50);

            spaceship.style.top = toPos.top;
            spaceship.style.left = toPos.left;

            setTimeout(() => {
                clearInterval(trailInterval);
                
                const lockElement = document.getElementById(`lock-${toIndex}`);
                if (lockElement) {
                    lockElement.style.animation = 'unlockAnimation 0.8s ease forwards';
                    setTimeout(() => {
                        lockElement.remove();
                        render();
                    }, 800);
                }
            }, 1500);
        }

        function checkAnswer(selectedIndex) {
            const planet = planets[gameState.currentPlanet];
            const question = planet.questions[gameState.currentQuestion];
            const buttons = document.querySelectorAll('.answer-btn');
            
            let selectedButton = null;
            let correctButton = null;
            
            question.shuffledAnswers.forEach(({ originalIndex }, displayIndex) => {
                if (originalIndex === selectedIndex) {
                    selectedButton = buttons[displayIndex];
                }
                if (originalIndex === question.correct) {
                    correctButton = buttons[displayIndex];
                }
            });

            if (selectedIndex === question.correct) {
                playSound('correct');
                selectedButton.style.animation = 'correctAnswer 0.5s ease';
                selectedButton.style.background = '#10b981';
                
                const rect = selectedButton.getBoundingClientRect();
                createParticles(rect.left + rect.width / 2, rect.top + rect.height / 2, '#10b981');
                
                setTimeout(() => {
                    gameState.currentQuestion++;
                    
                    if (gameState.currentQuestion >= 5) {
                        gameState.screen = 'mission_success';
                        render();
                    } else {
                        render();
                    }
                }, 800);
            } else {
                playSound('wrong');
                selectedButton.style.animation = 'wrongShake 0.5s ease';
                selectedButton.style.background = '#ef4444';
                
                correctButton.style.background = '#10b981';
                
                setTimeout(() => {
                    gameState.lives--;
                    
                    if (gameState.lives <= 0) {
                        stopTimer();
                        if (gameState.godMode) {
                            gameState.screen = 'explosion';
                        } else {
                            gameState.screen = 'gameover';
                        }
                    }
                    
                    render();
                }, 1500);
            }
        }

        function retryCurrentPlanet() {
            gameState.currentQuestion = 0;
            gameState.lives = 3;
            gameState.screen = 'story_intro';
            render();
        }

        function backToMapFromGameOver() {
            gameState.lives = 3;
            gameState.screen = 'map';
            render();
        }

        function resetGame() {
            stopTimer();
            gameState.screen = 'menu';
            gameState.lives = 3;
            gameState.godMode = false;
            gameState.timeRemaining = 600;
            render();
        }

        function fullReset() {
            playSound('click');
            stopTimer();
            gameState = {
                screen: 'map',
                lives: 3,
                currentPlanet: 0,
                currentQuestion: 0,
                completedPlanets: [],
                godMode: false,
                timeRemaining: 600,
                timerInterval: null
            };
            render();
        }

        function toggleMusic() {
            if (isMusicPlaying) {
                stopBackgroundMusic();
            } else {
                playBackgroundMusic();
            }
            render();
        }

        function toggleSoundEffects() {
            soundEffectsEnabled = !soundEffectsEnabled;
            if (soundEffectsEnabled) {
                playSound('click');
            }
            render();
        }

        async function onConfigChange(newConfig) {
            config = { ...newConfig };
            render();
        }

        const capabilities = {
            recolorables: [
                {
                    get: () => config.background_color || defaultConfig.background_color,
                    set: (value) => {
                        config.background_color = value;
                        window.elementSdk.setConfig({ background_color: value });
                    }
                },
                {
                    get: () => config.primary_color || defaultConfig.primary_color,
                    set: (value) => {
                        config.primary_color = value;
                        window.elementSdk.setConfig({ primary_color: value });
                    }
                },
                {
                    get: () => config.secondary_color || defaultConfig.secondary_color,
                    set: (value) => {
                        config.secondary_color = value;
                        window.elementSdk.setConfig({ secondary_color: value });
                    }
                },
                {
                    get: () => config.text_color || defaultConfig.text_color,
                    set: (value) => {
                        config.text_color = value;
                        window.elementSdk.setConfig({ text_color: value });
                    }
                },
                {
                    get: () => config.button_color || defaultConfig.button_color,
                    set: (value) => {
                        config.button_color = value;
                        window.elementSdk.setConfig({ button_color: value });
                    }
                }
            ],
            borderables: [],
            fontEditable: {
                get: () => config.font_family || defaultConfig.font_family,
                set: (value) => {
                    config.font_family = value;
                    window.elementSdk.setConfig({ font_family: value });
                }
            },
            fontSizeable: {
                get: () => config.font_size || defaultConfig.font_size,
                set: (value) => {
                    config.font_size = value;
                    window.elementSdk.setConfig({ font_size: value });
                }
            }
        };

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: () => capabilities,
                mapToEditPanelValues: (config) => new Map([
                    ["game_title", config.game_title || defaultConfig.game_title],
                    ["start_button_text", config.start_button_text || defaultConfig.start_button_text],
                    ["guide_button_text", config.guide_button_text || defaultConfig.guide_button_text],
                    ["victory_message", config.victory_message || defaultConfig.victory_message],
                    ["crisis_title", config.crisis_title || defaultConfig.crisis_title],
                    ["mission_button", config.mission_button || defaultConfig.mission_button]
                ])
            });
        }

        render();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b3f069c86a2959b',t:'MTc2NjczNTgzMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>